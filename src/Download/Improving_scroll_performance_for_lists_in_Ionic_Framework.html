

  <!DOCTYPE html>
<html>

  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Improving scroll performance for lists in Ionic Framework</title>
      <meta name="viewport" content="width=device-width">
      <meta name="description" content="Hello. My name is Thomas and I am a web and mobile developer from Berlin.">
      <link rel="canonical" href="/2015/01/12/improving-scroll-performance-for-lists-in-ionic-framework.html">

      <!-- Custom CSS -->
      <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:400,300,700' rel='stylesheet' type='text/css'>
      <link href='http://fonts.googleapis.com/css?family=Helvetica+Neue:400,700' rel='stylesheet' type='text/css'>
      <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
      <link rel="stylesheet" href="/css/global.css">

      <script src="/js/scripts.js"></script>


  </head>


    <body>
    <svg style="display: none;"><symbol viewBox="0 0 100 64.7" id="shape-email"><title>email</title> <path d="M5.9,0C0,0,2.9,2,5.9,4.4l41.2,33.8L94.1,4.4C97.1,2,100,0,94.1,0H47.1H5.9z"/> <path d="M0,8.8v50c0,2.9,3,5.9,5.3,5.9h89.3c2.4,0,5.3-2.9,5.3-5.9v-50L47.1,47.1L0,8.8z"/> </symbol><symbol viewBox="0 0 16 16" id="shape-github"><title>github</title> <path fill-rule="evenodd" clip-rule="evenodd" fill="#ffffff" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
  c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
  c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
  c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
  C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
  c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
  c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
  c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
  c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/> </symbol><symbol viewBox="0 0 142 19" id="shape-logo"><title>ThomasMaximini 2</title><desc>Created with Sketch.</desc> <!-- Generator: Sketch 3.2 (9961) - http://www.bohemiancoding.com/sketch -->    <g id="svgstore69fc1032e6adcdbca062e3cac91db953Welcome" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"> <g id="svgstore69fc1032e6adcdbca062e3cac91db953Tablet-Portrait" sketch:type="MSArtboardGroup" transform="translate(-10.000000, -15.000000)" font-weight="bold" font-family="Roboto Condensed" fill="#FFFFFF" font-size="22" font-style="condensed"> <g id="svgstore69fc1032e6adcdbca062e3cac91db953ThomasMaximini-2" sketch:type="MSLayerGroup" transform="translate(10.000000, 10.000000)"> <text id="svgstore69fc1032e6adcdbca062e3cac91db953ThomasMaximini" sketch:type="MSTextLayer"> <tspan x="0" y="23">Thomas</tspan> <tspan x="67.9228516" y="23" font-weight="260">Maximini</tspan> </text> </g> </g> </g> </symbol><symbol viewBox="0 0 18 15" id="shape-menu"><title>menu</title> <path fill="#ffffff" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
    h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/> <path fill="#ffffff" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
    h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/> <path fill="#ffffff" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
    c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/> </symbol><symbol viewBox="0 0 273.4 222.2" id="shape-twitter-black"><title>twitter-black</title> <path d="M273.4,26.3c-10.1,4.5-20.9,7.5-32.2,8.8c11.6-6.9,20.5-17.9,24.7-31C255,10.5,243,15.2,230.2,17.7C220,6.8,205.4,0,189.3,0
  c-31,0-56.1,25.1-56.1,56.1c0,4.4,0.5,8.7,1.5,12.8C88,66.5,46.7,44.2,19,10.3c-4.8,8.3-7.6,17.9-7.6,28.2c0,19.5,9.9,36.6,25,46.7
  c-9.2-0.3-17.8-2.8-25.4-7c0,0.2,0,0.5,0,0.7c0,27.2,19.3,49.8,45,55c-4.7,1.3-9.7,2-14.8,2c-3.6,0-7.1-0.4-10.6-1
  c7.1,22.3,27.9,38.5,52.4,39c-19.2,15-43.4,24-69.7,24c-4.5,0-9-0.3-13.4-0.8c24.8,15.9,54.3,25.2,86,25.2
  c103.2,0,159.6-85.5,159.6-159.6c0-2.4-0.1-4.9-0.2-7.3C256.4,47.4,265.9,37.5,273.4,26.3z"/> </symbol><symbol viewBox="0 0 16 16" id="shape-twitter"><title>twitter</title> <path fill="#ffffff" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
  c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
  c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
  C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
  c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
  c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/> </symbol></svg>

    <header class="site-header">
  <div class="wrap">
    <a class="site-title tm-logo" href="/"><b>Thomas</b>Maximini</a>

    <nav class="site-nav">

      <button class="lines-button x menu-icon" type="button" role="button" aria-label="Toggle Navigation">
        <span class="lines"></span>
      </button>
      <a class="inner-page-link" href="/">Home</a>
      <a class="inner-page-link" href="/articles">Articles</a>
      <a class="inner-page-link" href="/about/">About</a>
    </nav>
  </div>
</header>
<div class="menu-items">
  <a class="page-link" href="/">Home</a>
  <a class="page-link" href="/articles">Articles</a>
  <a class="page-link" href="/about/">About</a>
</div>


    <div class="page-content">
      <div class="wrap">
      <div class="post">
  <!-- <img src=""> -->
  <header class="post-header">
    <h1>Improving scroll performance for lists in Ionic Framework</h1>
    <p class="meta">Jan 12, 2015</p>
  </header>

  <article class="post-content">
  <h2 id="hybrid-mobile-applications">Hybrid mobile applications</h2>
<p>I recently spend a good amount of time developing an application using the <a href="http://ionicframework.com/">Ionic Framework</a>. In this post I am going to share my experiences and the things I learned on the way.</p>

<p>In case you don’t know, Ionic is a framework that sits on top of <a href="https://angularjs.org/">Angular.js</a> that is designed to let you write mobile hybrid apps. Mobile hybrid applications are applications entirely written in HTML5, CSS and Javascript and then get packaged into an installable, hopefully native looking application that can be distributed via the different App Stores.
Despite only being 1 year old, there have been already 320.000 apps been created with Ionic (<a href="http://ionicframework.com/blog/ionic-one-year-review/">Source</a>).
The difference is that hybrid applications live entirely inside a <em>WebView</em> of the device’s operating system.
This means that these applications will be affected by the different browser versions, OS versions and by the performance of the devices they are installed on. Both <a href="http://nshipster.com/wkwebkit/">iOS</a> and <a href="https://developer.chrome.com/multidevice/webview/overview">Android</a> are catching up though with the features and the performance of their WebViews, which is a good thing.</p>

<p>While Ionic is still a relatively young framework (currently in 1.0.0-beta14 at the time of this writing), hybrid mobile apps have been around for a long time by now. The problem with these apps is that they often feel clunky and slow compared to well-known native apps.
The main reason for that is not always bad browsers or old hardware but too often it is unperformant and badly optmized code. There are a lot of things to consider when writing performant web applications, especially for lower end devices. We’ll get to that in a minute.</p>

<h2 id="ionic-just-ui">Ionic, just UI?</h2>
<p>When you talk to people about Ionic, they will probably tell you something in the veins of “iOS7.css” or “that’s just an UI Layer around Angular”. Which is kind of true as a huge part of Ionic is about giving you a beautiful, iOS7’ish look. Basically it is an opinionated collection of Angular directives and css classes that cover a lot of use cases when building an app. <a href="http://ionicframework.com/docs/api/directive/ionSlideBox/">Swipeable boxes</a>, <a href="http://ionicframework.com/docs/api/directive/ionRefresher/">pull-to-refresh lists</a>, <a href="http://ionicframework.com/docs/api/directive/ionTabs/">tab navigations</a> <a href="http://ionicframework.com/docs/api/directive/ionSideMenus/">etc</a>. You name it.
What I especially like about Ionic so far is its <a href="http://ionicframework.com/docs/">excellent documentation</a>, the amount of <a href="http://learn.ionicframework.com/">learning resources</a>, the cli tooling and the active community (#ionic at Freenode).</p>

<h2 id="scroll-performance">Scroll performance</h2>
<p>One of the big letdowns with Ionic has been the scroll performance. Everything worked great developing on my desktop browser emulating mobile devices, but as soon as we compiled the app on the phone it <em>lagged</em>. The lag was real.
The problem with Ionic lists is, that by default Ionic uses a Javascript based scrolling mechanism, which calculates the scroll position in a view and animates it whenever the view is scrolled. While this looks really good and solves a lot of compatibility issues between different devices and browsers it certainly is a huge performance issue with longer list. For us, lists with around 25-50 items and some images already rendered close to unusable on iPhone4 and 4s. Imagine you’d want to make some timeline app such as Twitter.
As stated by the core team members, <a href="https://github.com/driftyco/ionic/issues/287#issuecomment-30441099">Ionic is targeted towards newer devices</a>, which makes totally sense from a deveoping point of view. The problem is you can not convince your customer’s that the app can only run on newer devices, it should run performant on older devices as well.</p>

<p>As far as I can tell there are two main solutions for the scrolling performance problem:</p>

<ol>
  <li>Using <a href="http://ionicframework.com/docs/api/directive/collectionRepeat/">collection-repeat</a> instead ng-repeat</li>
  <li>Using native scroll</li>
</ol>

<p>We will take a look at both of these now.</p>

<h3 id="collection-repeat">collection-repeat</h3>
<p>Quoting the docs here:</p>

<blockquote>
  <p>collection-repeat is a directive that allows you to render lists with thousands of items in them, and experience little to no performance penalty.</p>
</blockquote>

<p>This sounds pretty awesome. And it is really awesome too: The idea behind collection-repeat is that it renders only the items that are currently visible inside the viewport, so if you have 2000 items but only 10 items fit into your screen than 10 items will be rendered instead of 2000 (The problem with the performance of huge lists is usually the <em>painting</em> in the browser). The problem with collection-repeat however is that the items need to be of the same height (more or less at least, as collection-item-height takes an expression and thus also could be a function). So basically  <em>it makes a responsive layout impossible</em>, assuming you want to use 100% width and height: auto; or something like this.</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;contact-list&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">ng-repeat=</span><span class="s">&quot;person in contacts | filter:{name: searchModel.name}&quot;</span>
     <span class="na">class=</span><span class="s">&quot;item item-icon-right&quot;</span>
     <span class="na">ng-class=</span><span class="s">&quot;{&#39;selected&#39;: option.active}&quot;</span>
     <span class="na">ng-click=</span><span class="s">&quot;showDetails(person)&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">ng-bind=</span><span class="s">&quot;::person.name&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre></div>

<p>It is very useful though for items of the same fixed height, such as simple lists.</p>

<h3 id="native-scrolling">Native scrolling</h3>

<p>Native scrolling means we tell Ionic not to use its <a href="http://ionicframework.com/docs/api/service/$ionicScrollDelegate/">$ionicScrollDelegate</a> service for scrolling, but instead fall back to the browser’s own scrolling behaviour. As scrolling is one of the most basic features of any browser, this usually means we get a great performance across all devices.
There are a few drawbacks from this solution though:</p>

<ul>
  <li>Scroll behaviour might differentiate quite a bit between different browsers and operating systems. This bit us a few times, especially with iOS being weird with firing scroll events. See <a href="http://developer.telerik.com/featured/scroll-event-change-ios-8-big-deal/">this blog post by TJ VanToll</a> for more information on iOS scroll behaviour.</li>
  <li>By default, no scrollbar is visible (Can be overwritten by CSS).</li>
  <li>Infinite Scroll and Pull to refresh won’t work, we had to write our own solution for both.</li>
</ul>

<p>To activate native scrolling in Ionic, you just the the <code>"overflow-scroll = true"</code> option on <a href="http://ionicframework.com/docs/api/directive/ionContent/">IonContent</a>. It is super performant and was the only valid solution in our case, as we wanted to support also older devices.</p>

<p>Infinite scroll could for example easily be implemented like this, with <code>wrapperEl</code> being your overflow-scroll IonContent element and <code>listEl</code> being the inner stream container, that would contain your ng-repeated list that you want to load new items into.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/**</span>
<span class="cm"> * captures all scroll events and checks offset from top and distance from bottom</span>
<span class="cm"> * if we are as close as OFFSET to bottom, we start loading the next page</span>
<span class="cm"> */</span>
<span class="kd">var</span> <span class="nx">OFFSET</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span> <span class="c1">// how many px from bottom should we start loading</span>
<span class="nx">wrapperEl</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">listRect</span> <span class="o">=</span> <span class="nx">listEL</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">wrapRect</span> <span class="o">=</span> <span class="nx">wrapperEl</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">listRect</span><span class="p">.</span><span class="nx">bottom</span> <span class="o">-</span> <span class="nx">OFFSET</span> <span class="o">&lt;</span> <span class="nx">wrapRect</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">scope</span><span class="p">.</span><span class="nx">nextPage</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span></code></pre></div>

<p>Although iOS momentum scrolling does not send continous scroll events after your touch move ended, it will send one more scroll event when the momentum scroll finishes, which is enough for this solution to check again and trigger the infinite scroll.</p>

<h3 id="conclusion">Conclusion</h3>

<p>Ionic does a great job at delivering excellent CSS and great directives that enable developers to build good looking with ease. For larger lists or more complex views we might hit performance bottlenecks quickly. In this case native scrolling is the best option for performance gains. These gains however come at the costs of browser and OS inconsistencies and not being able to use certain built-in features of Ionic and having to re-implement those yourself more or less from scratch.</p>

<h2 id="update-032015">UPDATE 03/2015</h2>

<p>The Ionic Team itself are acknowledging the downsides of Javascript-based scrolling and are working on rewriting their scrolling system  based on native scrolling. You should follow <a href="http://forum.ionicframework.com/t/native-scrolling-android-testers-wanted/17059">this thread</a> for more information. Also, native scrolling can now be set globally like this:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;ionicApp&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ionic&#39;</span><span class="p">]).</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$ionicConfigProvider</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">ionic</span><span class="p">.</span><span class="nx">Platform</span><span class="p">.</span><span class="nx">isIOS</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">$ionicConfigProvider</span><span class="p">.</span><span class="nx">scrolling</span><span class="p">.</span><span class="nx">jsScrolling</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">})</span></code></pre></div>

<p>instead of setting <code>overflow-scroll="true"</code> on each <code>ion-content</code> element.</p>

  </article>

</div>
<div class="social">
  <div class="inner">
    <a href="https://twitter.com/share" class="twitter-share-button" data-via="tmaximini">Tweet</a>
  </div>

</div>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">


    <div class="footer-col-1 column">
        <span class="tm-image">
          <img src="/images/thomasmaximini.png" alt="Thomas Maximini" title="yup. that's me.">
        </span>
        <span class="tm-text">
          <p class="text">Hello. My name is Thomas and I am a web and mobile developer from Berlin.</p>
        </span>
    </div>

    <div class="footer-col-3 column">
      <ul>
        <li>
          <a href="https://twitter.com/tmaximini">
            <span class="icon twitter">
              <svg class="twitter-icon-svg">
                <use xlink:href="#shape-twitter" />
              </svg>
            </span>
            <span class="username">tmaximini</span>
          </a>
        </li>
        <li>
          <span class="icon github">
            <svg class="github-icon-svg">
              <use xlink:href="#shape-github" />
            </svg>
          </span>
          <a href="https://github.com/tmaximini">
            <span class="username">tmaximini</span>
          </a>
        </li>
        <li><a href="mailto:tmaximini@gmail.com">tmaximini@gmail.com</a></li>
      </ul>
    </div>



  </div>

</footer>


    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58482333-1', 'auto');
  ga('send', 'pageview');

</script>

    </body>
</html>
